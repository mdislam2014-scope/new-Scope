from flask import Flask, render_template, request

app = Flask(__name__)

# -------------------------
# .30-06 Scope Data (50–500 yards)
# -------------------------
NEW_RAW_SCOPE_DATA_30 = [
    {"range": 50, "rel_inches": 0.00},
    {"range": 60, "rel_inches": 0.05},
    {"range": 70, "rel_inches": 0.10},
    {"range": 80, "rel_inches": 0.15},
    {"range": 90, "rel_inches": 0.20},
    {"range": 100, "rel_inches": 0.125},
    {"range": 110, "rel_inches": 0.15},
    {"range": 120, "rel_inches": 0.00},
    {"range": 130, "rel_inches": -0.20},
    {"range": 140, "rel_inches": -0.40},
    {"range": 150, "rel_inches": -0.60},
    {"range": 160, "rel_inches": -0.90},
    {"range": 170, "rel_inches": -1.30},
    {"range": 180, "rel_inches": -1.90},
    {"range": 190, "rel_inches": -2.60},
    {"range": 200, "rel_inches": -3.50},
    {"range": 210, "rel_inches": -4.60},
    {"range": 220, "rel_inches": -5.80},
    {"range": 230, "rel_inches": -7.10},
    {"range": 240, "rel_inches": -8.60},
    {"range": 250, "rel_inches": -10.10},
    {"range": 260, "rel_inches": -12.00},
    {"range": 270, "rel_inches": -14.20},
    {"range": 280, "rel_inches": -16.40},
    {"range": 290, "rel_inches": -18.60},
    {"range": 300, "rel_inches": -21.30},
    {"range": 310, "rel_inches": -23.90},
    {"range": 320, "rel_inches": -26.80},
    {"range": 330, "rel_inches": -29.80},
    {"range": 340, "rel_inches": -33.00},
    {"range": 350, "rel_inches": -36.30},
    {"range": 360, "rel_inches": -39.70},
    {"range": 370, "rel_inches": -43.30},
    {"range": 380, "rel_inches": -47.10},
    {"range": 390, "rel_inches": -51.00},
    {"range": 400, "rel_inches": -55.10},
    {"range": 410, "rel_inches": -59.30},
    {"range": 420, "rel_inches": -63.60},
    {"range": 430, "rel_inches": -68.10},
    {"range": 440, "rel_inches": -72.70},
    {"range": 450, "rel_inches": -77.50},
    {"range": 460, "rel_inches": -82.50},
    {"range": 470, "rel_inches": -87.60},
    {"range": 480, "rel_inches": -92.90},
    {"range": 490, "rel_inches": -98.20},
    {"range": 500, "rel_inches": -103.80}
]

# -------------------------
# Helper functions
# -------------------------
def inches_per_moa_at(range_yd):
    return 1.047 * (range_yd / 100.0)

def calculate_clicks(range_yd, rel_in):
    if range_yd == 0:
        return 0.0
    moa = rel_in / inches_per_moa_at(range_yd)
    clicks = -moa * 4.0
    return clicks

def get_adjustment(data, target_range_yd):
    for d in data:
        if d["range"] == target_range_yd:
            rel_in = d["rel_inches"]
            raw_clicks = calculate_clicks(target_range_yd, rel_in)
            rounded_clicks = round(raw_clicks)
            if rounded_clicks > 0:
                direction = "UP"
            elif rounded_clicks < 0:
                direction = "DOWN"
            else:
                direction = "—"
            if rel_in > 0:
                drop_text = f"high {rel_in:.2f} inch"
            elif rel_in < 0:
                drop_text = f"drop {abs(rel_in):.2f} inch"
            else:
                drop_text = "0 inch"
            click_text = f"{abs(rounded_clicks)} {direction}" if direction != "—" else "0"
            return drop_text, click_text
    return None, None

# -------------------------
# Flask routes
# -------------------------
@app.route("/", methods=["GET", "POST"])
def home():
    result = ""
    if request.method == "POST":
        try:
            distance = int(request.form.get("distance"))
            drop, clicks = get_adjustment(NEW_RAW_SCOPE_DATA_30, distance)
            if drop is None:
                result = "Range not available. Use multiples of 10 from 50–500."
            else:
                result = f"Impact: {drop}, Scope adjustment: {clicks}"
        except:
            result = "Please enter a valid number."
    return render_template("index.html", result=result)

if __name__ == "__main__":
    app.run(debug=True)

